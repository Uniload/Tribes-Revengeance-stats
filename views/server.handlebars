<div class="main">
    {{#if alerts}}
    {{#each alerts}}
  	<div class="alert alert-warning alert-dismissible" role="alert">
	  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	  {{text}}
	</div>
	{{/each}}
    {{/if}}

	{{#if data}}
	<h2>{{data.name}} <small>{{data._id}}</small></h2>
	{{#if online}}
	<h4 style="color:#00AA00">Online</h4>
	{{else}} 
	<h4 style="color:#AA0000">Offline</h4>
	{{/if}}
	<table class="table table-bordered">
		<tr><td>Admin name</td><td>{{data.adminname}}</td></tr>
		<tr><td>Admin email</td><td>{{data.adminemail}}</td></tr>
		<tr><td>Time online</td><td>{{showMinutes data.minutesonline}}</td></tr>
		<tr><td>Max players</td><td>{{data.maxplayers}}</td></tr>
		<tr><td>Last seen</td><td>{{showMoment data.lastseen}}</td></tr>
		<tr>
			<td>Last full report</td>
			{{#if data.lastfullreport}}
			<td>{{showMoment data.lastfullreport}}</td>
			{{else}}
			<td>Never (server side mod is not installed)</td>
			{{/if}}
		</tr>
	</table>

		{{#if online}}
		<h3>Players</h3>
		<table class="table table-bordered">
			<tr>
				<th>Name</th>
				<th>Score</th>
				<th>Team</th>
				<th>Ping</th>
			</tr>

			{{#each data.lastdata.players}}
			<tr>
				<td><a href="/player/{{urlencode player}}">{{player}}</a></td>
				<td>{{score}}</td>
				<td>{{team}}</td>
				<td>{{ping}}</td>
			</tr>
			{{/each}}
		</table>
		{{/if}}
		
		<br>
		<h3>Number of players online in last 2 days</h3>
		<span id="chartdata" style="display:none">{{json tracks}}</span>
		<div id="chart_div" style="width: 900px; height: 400px;margin-left:auto;margin-right:auto"></div>
		
		<script type="text/javascript" src="//www.google.com/jsapi"></script>
	    <script type="text/javascript">
	      var dataSpan = JSON.parse(document.getElementById('chartdata').innerHTML);
	      var chartData = [];
	      //chartData.push(["Time","Players"]);
	      for(var i in dataSpan){
	      	var date = new Date(dataSpan[i].time);
	      	var formated = date.getMonth()+"-"+date.getDate()+" "+date.getHours()+":"+date.getSeconds();
	      	chartData.push([formated,dataSpan[i].players]);
	      }
	      console.log(chartData);
	      google.load("visualization", "1.1", {packages:["bar"]});
	      google.setOnLoadCallback(drawChart);
	      function drawChart() {
	      	console.log(chartData);
	      	var data = new google.visualization.DataTable();
		    data.addColumn('string','Time');
		    data.addColumn('number', 'Players');
		    data.addRows(chartData);

	        var options = {
	          title: 'Number of players online in last 2 days',
	          bars: 'vertical',
			  width: 900,
			  height: 400
	        };

	        var chart = new google.charts.Bar(document.getElementById('chart_div'));
	        chart.draw(data, options);
	      }
	    </script>
	{{else}}
	Server not found
	{{/if}}
</div>